<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VivicoreSerial library: 09_message_board.ino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VivicoreSerial library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">09_message_board.ino</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line">#define MIN_LIBRARY_VER_BUILD_NO (0x0012)</div>
<div class="line">#include &lt;VivicoreSerial.h&gt;</div>
<div class="line">#include &lt;Wire.h&gt;</div>
<div class="line">#include &lt;misakiUTF16.h&gt;</div>
<div class="line">#include &quot;31FL3731regs.h&quot;</div>
<div class="line"> </div>
<div class="line">#define EN_PIN   (10)</div>
<div class="line">#define IRQ1_PIN (2)</div>
<div class="line">#define IRQ2_PIN (3)</div>
<div class="line"> </div>
<div class="line">#define LEDX         (24)</div>
<div class="line">#define LEDX_BY_IC   (16)</div>
<div class="line">#define LEDX_BY_CHAR (4)</div>
<div class="line">#define LEDY         (9)</div>
<div class="line"> </div>
<div class="line">#define SCROLL_INTERVAL  (70)   // 100: 100mS per line</div>
<div class="line">#define BRIGHT_NORMAL    (0x33) // 1:min, 0xff:max 2mA per led chip.</div>
<div class="line">#define BRIGHT_LOW       (0x10) // 1:min, 0xff:max 2mA per led chip.</div>
<div class="line">#define MAX_BURST_LENGTH (31)</div>
<div class="line"> </div>
<div class="line">#define UTF16_CHAR_PERIOD (0xFF61) // Hankaku Kana min value</div>
<div class="line">#define UTF16_CHAR_PSOUND (0xFF9F) // Hankaku Kana max value</div>
<div class="line"> </div>
<div class="line">#define DISP_BUF_SIZE (17)</div>
<div class="line">#define WORK_BUF_SIZE (DISP_BUF_SIZE + 1) // String data size 17 + setting flag 1</div>
<div class="line">#define FONT_V_SIZE   (FONT_LEN)</div>
<div class="line">#define IMAGE_H_NUM   (DISP_BUF_SIZE + 2)</div>
<div class="line">#define IMAGE_H_SIZE  (IMAGE_H_NUM * 4)</div>
<div class="line">#define IMAGE_V_SIZE  (max(LEDY, FONT_V_SIZE))</div>
<div class="line">#define IMAGE_V_SHIFT (-1)</div>
<div class="line"> </div>
<div class="line">const char *INITIAL_TEXT = &quot;&quot;;</div>
<div class="line"> </div>
<div class="line">const uint8_t  USER_FW_MAJOR_VER = 0x01;</div>
<div class="line">const uint8_t  USER_FW_MINOR_VER = 0x01;</div>
<div class="line">const uint16_t USER_FW_VER       = (((uint16_t)(USER_FW_MAJOR_VER) &lt;&lt; 8) + ((uint16_t)(USER_FW_MINOR_VER)));</div>
<div class="line">const uint32_t BRANCH_TYPE       = 0x00000009;</div>
<div class="line"> </div>
<div class="line">const dcInfo_t dcInfo[] = {</div>
<div class="line">  // {group_no, data_nature, data_type, data_min, data_max}</div>
<div class="line">  {DcGroup_t::DC_GROUP_1, DcNature_t::DC_NATURE_IN, DcType_t::DC_TYPE_BINARY, 0, 255} // 1: Text Input</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">const uint8_t slave_adrs[2]         = {0x77, 0x74};</div>
<div class="line">const uint8_t connected_banks[2][2] = {</div>
<div class="line">  // CA, CB</div>
<div class="line">  {1, 1}, // slave_adrs[0]</div>
<div class="line">  {0, 1}, // slave_adrs[1]</div>
<div class="line">};</div>
<div class="line">byte ImageBuf[IMAGE_H_NUM][IMAGE_V_SIZE] = {}; // IMAGE_H_NUM 文字 x IMAGE_V_SIZE byte pattern buffer</div>
<div class="line">byte ImageWidth[IMAGE_H_NUM]             = {}; // font width</div>
<div class="line">byte ImageBright[IMAGE_H_NUM]            = {}; // Bright values</div>
<div class="line">byte ImageLen                            = 0;  // 文字数</div>
<div class="line"> </div>
<div class="line">inline void writeReg(const uint8_t slave_adr, const uint8_t reg, const uint8_t data) {</div>
<div class="line">  Wire.beginTransmission(slave_adr);</div>
<div class="line">  Wire.write(reg);</div>
<div class="line">  Wire.write(data);</div>
<div class="line">  Wire.endTransmission();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void selectPage(const uint8_t slave_adr, const uint8_t page) {</div>
<div class="line">  writeReg(slave_adr, REG_POINT_TO_PAGE, page);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void writeRegByPage(const uint8_t slave_adr, const uint8_t page, const uint8_t reg, const uint8_t data) {</div>
<div class="line">  selectPage(slave_adr, page);</div>
<div class="line">  writeReg(slave_adr, reg, data);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void writeRegBurst(const uint8_t slave_adr, const uint8_t reg, const int len, const byte data) {</div>
<div class="line">  // maximum burst length is 31! there is no description in datasheet.</div>
<div class="line">  if (len &gt; MAX_BURST_LENGTH) {</div>
<div class="line">    return;</div>
<div class="line">  }</div>
<div class="line">  Wire.beginTransmission(slave_adr);</div>
<div class="line">  Wire.write(reg);</div>
<div class="line">  for (int i = 0; i &lt; len; i++) {</div>
<div class="line">    Wire.write(data);</div>
<div class="line">  }</div>
<div class="line">  Wire.endTransmission();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">inline uint8_t convPosToSlaveAdr(const uint8_t x) {</div>
<div class="line">  const uint8_t idx = (x &lt; LEDX_BY_IC) ? 0 : 1;</div>
<div class="line">  return slave_adrs[idx];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">inline uint8_t convPosToPwmReg(const uint8_t x, const uint8_t y) {</div>
<div class="line">  const uint8_t x_ = (x &lt; LEDX_BY_IC) ? x : x - LEDX_BY_IC;</div>
<div class="line">  return REG_START_PWM_CTRL + (LEDX_BY_IC - x_) - 1 + (y * LEDX_BY_IC);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// draw a pixel on the screen. The left up side is origin.</div>
<div class="line">// illum is 0x40 is good in the bright room.</div>
<div class="line">void writeDot(const int x, const int y, const int illum) {</div>
<div class="line">  if ((x &gt;= LEDX) || (x &lt; 0) || (y &gt;= LEDY) || (y &lt; 0)) {</div>
<div class="line">    return;</div>
<div class="line">  }</div>
<div class="line">  writeReg(convPosToSlaveAdr(x), convPosToPwmReg(x, y), illum);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Clear screen with using burst command.</div>
<div class="line">void fillScreen(const uint8_t illum) {</div>
<div class="line">  for (uint8_t idx = 0; idx &lt; sizeof(slave_adrs); idx++) {</div>
<div class="line">    const uint8_t num_burst       = (REG_END_PWM_CTRL - REG_START_PWM_CTRL + 1) / MAX_BURST_LENGTH;</div>
<div class="line">    const uint8_t last_burst_size = (REG_END_PWM_CTRL - REG_START_PWM_CTRL + 1) % MAX_BURST_LENGTH;</div>
<div class="line">    for (uint8_t n = 0; n &lt; num_burst; n++) {</div>
<div class="line">      writeRegBurst(slave_adrs[idx], REG_START_PWM_CTRL + n * MAX_BURST_LENGTH, MAX_BURST_LENGTH, illum);</div>
<div class="line">    }</div>
<div class="line">    writeRegBurst(slave_adrs[idx], REG_START_PWM_CTRL + num_burst * MAX_BURST_LENGTH, last_burst_size, illum);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void writeImage(const char *pUTF8) {</div>
<div class="line">  static uint16_t pUTF16[IMAGE_H_NUM];</div>
<div class="line">  uint8_t         n = Utf8ToUtf16(pUTF16, const_cast&lt;char *&gt;(pUTF8));</div>
<div class="line"> </div>
<div class="line">  if (n &gt; IMAGE_H_NUM) {</div>
<div class="line">    n = IMAGE_H_NUM;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  for (byte i = 0; i &lt; n; i++) {</div>
<div class="line">    const uint16_t d         = pUTF16[i];</div>
<div class="line">    bool           validFont = false;</div>
<div class="line"> </div>
<div class="line">    ImageBright[i] = BRIGHT_NORMAL;</div>
<div class="line">    memset(&amp;ImageBuf[i][0], 0, IMAGE_V_SIZE);</div>
<div class="line">    validFont = getFontDataByUTF16(&amp;ImageBuf[i][0], pUTF16[i]);</div>
<div class="line"> </div>
<div class="line">    if (!validFont) {</div>
<div class="line">      memset(&amp;ImageBuf[i][0], 0xFF, IMAGE_V_SIZE);</div>
<div class="line">      ImageWidth[i]  = 4;</div>
<div class="line">      ImageBright[i] = BRIGHT_LOW;</div>
<div class="line">    } else if ((highByte(d) == 0) || ((d &gt;= UTF16_CHAR_PERIOD) &amp;&amp; (d &lt;= UTF16_CHAR_PSOUND))) {</div>
<div class="line">      ImageWidth[i] = 4;</div>
<div class="line">    } else {</div>
<div class="line">      ImageWidth[i] = 8;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  ImageLen = n;</div>
<div class="line">  for (byte img_n = ImageLen; img_n &lt; IMAGE_H_NUM; img_n++) {</div>
<div class="line">    for (byte img_v = 0; img_v &lt; IMAGE_V_SIZE; img_v++) {</div>
<div class="line">      ImageBuf[img_n][img_v] = 0;</div>
<div class="line">    }</div>
<div class="line">    ImageWidth[img_n] = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void updateScr(const int shift_h, const int shift_v, const bool clear) {</div>
<div class="line">  int x_lside = 0;</div>
<div class="line"> </div>
<div class="line">  if (clear) {</div>
<div class="line">    fillScreen(0);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  for (byte img_n = 0; img_n &lt; ImageLen; img_n++) {</div>
<div class="line">    const byte img_width  = ImageWidth[img_n];</div>
<div class="line">    const byte img_bright = ImageBright[img_n];</div>
<div class="line"> </div>
<div class="line">    for (byte img_v = 0; img_v &lt; IMAGE_V_SIZE; img_v++) {</div>
<div class="line">      const byte img_line = ImageBuf[img_n][img_v];</div>
<div class="line"> </div>
<div class="line">      for (byte img_h = 0; img_h &lt; img_width; img_h++) {</div>
<div class="line">        const uint8_t is_draw = bitRead(img_line, 7 - img_h);</div>
<div class="line"> </div>
<div class="line">        if (is_draw) {</div>
<div class="line">          int x_scr = x_lside + img_h - shift_h;</div>
<div class="line">          int y_scr = img_v - shift_v;</div>
<div class="line">          DebugPlainPrint2(x_scr);</div>
<div class="line">          DebugPlainPrint2(&quot;,&quot;);</div>
<div class="line">          DebugPlainPrintln2(y_scr);</div>
<div class="line">          if (x_scr &lt; 0) {</div>
<div class="line">            x_scr += IMAGE_H_NUM * 4;</div>
<div class="line">          } else if (x_scr &gt;= (IMAGE_H_NUM * 4)) {</div>
<div class="line">            x_scr -= IMAGE_H_NUM * 4;</div>
<div class="line">          }</div>
<div class="line">          if (y_scr &lt; 0) {</div>
<div class="line">            y_scr += IMAGE_V_SIZE;</div>
<div class="line">          } else if (y_scr &gt;= IMAGE_V_SIZE) {</div>
<div class="line">            y_scr -= IMAGE_V_SIZE;</div>
<div class="line">          }</div>
<div class="line">          DebugPlainPrint2(x_scr);</div>
<div class="line">          DebugPlainPrint2(&quot;,&quot;);</div>
<div class="line">          DebugPlainPrintln2(y_scr);</div>
<div class="line">          writeDot(x_scr, y_scr, img_bright);</div>
<div class="line">          // DebugPlainPrint2(&quot;*&quot;);</div>
<div class="line">        } else {</div>
<div class="line">          // DebugPlainPrint2(&quot; &quot;);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    x_lside += img_width;</div>
<div class="line">    DebugPlainPrintln2(&quot;&quot;);</div>
<div class="line">  }</div>
<div class="line">  DebugPlainPrintln2(&quot;&quot;);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void convCharImage(const uint8_t *charbuf) {</div>
<div class="line">  char buf[DISP_BUF_SIZE + 1] = {}; // +1 is for null terminate</div>
<div class="line">  memcpy(buf, charbuf, DISP_BUF_SIZE);</div>
<div class="line">  writeImage(buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool isValidCtrlReg(const uint8_t slave_adr, const uint8_t reg) {</div>
<div class="line">  // LEDs which are no connected must be off by LED Control Register (Frame Registers) or it will affect other LEDs.</div>
<div class="line">  uint8_t       adr_idx  = 0;</div>
<div class="line">  const uint8_t bank_idx = bitRead(reg, 0);</div>
<div class="line"> </div>
<div class="line">  for (; adr_idx &lt; sizeof(slave_adrs); adr_idx++) {</div>
<div class="line">    if (slave_adr == slave_adrs[adr_idx]) {</div>
<div class="line">      break;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  if ((adr_idx &gt;= sizeof(slave_adrs)) || (REG_END_LED_CTRL &lt; reg)) {</div>
<div class="line">    return false;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  return (bool)connected_banks[adr_idx][bank_idx];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void initDisp(void) {</div>
<div class="line">  // Clear frame buffer before switching power to prevent showing garbage</div>
<div class="line">  fillScreen(0);</div>
<div class="line"> </div>
<div class="line">  for (uint8_t n = 0; n &lt; sizeof(slave_adrs); n++) {</div>
<div class="line">    const uint8_t slave_adr = slave_adrs[n];</div>
<div class="line">    uint8_t       frame_reg;</div>
<div class="line"> </div>
<div class="line">    // shutdown-&gt;normal operation</div>
<div class="line">    writeRegByPage(slave_adr, PAGE_TO_FUNC, FUNC_TO_SHUTDOWN, 0);</div>
<div class="line">    delay(10);</div>
<div class="line">    writeRegByPage(slave_adr, PAGE_TO_FUNC, FUNC_TO_SHUTDOWN, 1);</div>
<div class="line">    // picture mode</div>
<div class="line">    writeRegByPage(slave_adr, PAGE_TO_FUNC, FUNC_TO_CONFIG, 0);</div>
<div class="line">    // display picture frame 0 only</div>
<div class="line">    writeRegByPage(slave_adr, PAGE_TO_FUNC, FUNC_TO_PICT_DISP, 0);</div>
<div class="line"> </div>
<div class="line">    /// LED pixel pattern</div>
<div class="line">    for (frame_reg = 0; frame_reg &lt;= REG_END_LED_CTRL; frame_reg++) {</div>
<div class="line">      if (isValidCtrlReg(slave_adr, frame_reg)) {</div>
<div class="line">        writeRegByPage(slave_adr, 0, frame_reg, 0xff);</div>
<div class="line">      } else {</div>
<div class="line">        writeRegByPage(slave_adr, 0, frame_reg, 0x00);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    /// blink all off</div>
<div class="line">    for (; frame_reg &lt;= REG_END_BLINK_CTRL; frame_reg++) {</div>
<div class="line">      writeRegByPage(slave_adr, 0, frame_reg, 0x00);</div>
<div class="line">    }</div>
<div class="line">    /// PWM all off</div>
<div class="line">    for (; frame_reg &lt;= REG_END_PWM_CTRL; frame_reg++) {</div>
<div class="line">      writeRegByPage(slave_adr, 0, frame_reg, 0x00);</div>
<div class="line">    }</div>
<div class="line">    writeRegByPage(slave_adr, PAGE_TO_FUNC, FUNC_TO_AUDIO_SYNC, 0); // audio sync off</div>
<div class="line">    selectPage(slave_adr, 0);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void initScr() {</div>
<div class="line">  fillScreen(0);</div>
<div class="line">  writeImage(INITIAL_TEXT);</div>
<div class="line">  updateScr(0, IMAGE_V_SHIFT, false);</div>
<div class="line">  delay(100);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">  Vivicore.begin(BRANCH_TYPE, USER_FW_VER, dcInfo, countof(dcInfo), MIN_LIBRARY_VER_BUILD_NO);</div>
<div class="line"> </div>
<div class="line">  digitalWrite(EN_PIN, HIGH);</div>
<div class="line">  pinMode(EN_PIN, OUTPUT);</div>
<div class="line">  pinMode(IRQ1_PIN, INPUT);</div>
<div class="line">  pinMode(IRQ2_PIN, INPUT);</div>
<div class="line"> </div>
<div class="line">  Wire.begin();</div>
<div class="line">  Wire.setClock(400000L); // 400kHz I2C clock</div>
<div class="line"> </div>
<div class="line">  // A basic scanner, see if it ACK&#39;s</div>
<div class="line">  for (uint8_t n = 0; n &lt; sizeof(slave_adrs); n++) {</div>
<div class="line">    Wire.beginTransmission(slave_adrs[n]);</div>
<div class="line">    if (Wire.endTransmission() != 0) {</div>
<div class="line">      DebugPlainPrint1(&quot;No ack from 0x&quot;);</div>
<div class="line">      DebugHexPrint1(slave_adrs[n]);</div>
<div class="line">      DebugPlainPrintln1();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  initDisp();</div>
<div class="line">  initScr();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line">  static uint8_t       charbuffer[DISP_BUF_SIZE] = {};</div>
<div class="line">  static bool          is_scroll                 = false;</div>
<div class="line">  static bool          is_enabled                = true;</div>
<div class="line">  static int           image_h_shift             = 0;</div>
<div class="line">  static unsigned long prev_time                 = 0;</div>
<div class="line">  const AvailableNum_t recv_cnt                  = Vivicore.available();</div>
<div class="line">  RawData_t            raw                       = {};</div>
<div class="line"> </div>
<div class="line">  if (recv_cnt.raw &gt; 0) {</div>
<div class="line">    raw = Vivicore.readRaw();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  if (raw.success &amp;&amp; (raw.data_len &gt; 0)) {</div>
<div class="line">    DebugPlainPrint1(&quot;success:&quot;);</div>
<div class="line">    DebugPlainPrint1(raw.success);</div>
<div class="line">    DebugPlainPrint1(&quot;, len:&quot;);</div>
<div class="line">    DebugPlainPrint1(raw.data_len);</div>
<div class="line">    DebugPlainPrint1(&quot;, data:&quot;);</div>
<div class="line">    for (uint8_t i = 0; i &lt; raw.data_len; i++) {</div>
<div class="line">      // Dump raw data</div>
<div class="line">      DebugHexPrint1(raw.data[i]);</div>
<div class="line">    }</div>
<div class="line">    DebugPlainPrintln1();</div>
<div class="line"> </div>
<div class="line">    is_scroll  = ((raw.data[0] &amp; 0x01) != 0);</div>
<div class="line">    is_enabled = ((raw.data[0] &amp; 0x02) != 0);</div>
<div class="line">    for (uint8_t char_idx = 0; char_idx &lt; DISP_BUF_SIZE; char_idx++) {</div>
<div class="line">      charbuffer[char_idx] = (char_idx &lt; raw.data_len) ? raw.data[char_idx + 1] : &#39; &#39;;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    image_h_shift = 0;</div>
<div class="line">    prev_time     = millis();</div>
<div class="line"> </div>
<div class="line">    convCharImage(is_enabled ? charbuffer : reinterpret_cast&lt;const uint8_t *&gt;(INITIAL_TEXT));</div>
<div class="line">    updateScr(image_h_shift, IMAGE_V_SHIFT, true);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // Dont care about millis overflows https://garretlab.web.fc2.com/arduino/lab/millis/</div>
<div class="line">  if (is_scroll &amp;&amp; (millis() - prev_time &gt; SCROLL_INTERVAL)) {</div>
<div class="line">    prev_time += SCROLL_INTERVAL;</div>
<div class="line">    if (is_enabled) {</div>
<div class="line">      updateScr(image_h_shift, IMAGE_V_SHIFT, true);</div>
<div class="line">      image_h_shift++;</div>
<div class="line">      if (image_h_shift &gt; IMAGE_H_SIZE) {</div>
<div class="line">        image_h_shift = 0;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    DebugPlainPrint1(&quot;h_shift:&quot;);</div>
<div class="line">    DebugPlainPrintln1(image_h_shift);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  delay(10);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
