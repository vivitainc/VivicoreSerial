<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VivicoreSerial library: VivicoreSerial Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VivicoreSerial library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_vivicore_serial-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">VivicoreSerial Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class is for branch to talk with core.  
 <a href="class_vivicore_serial.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_vivicore_serial_8h_source.html">VivicoreSerial.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1964aeda33f77fd8a3fdcf0debc39661"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a1964aeda33f77fd8a3fdcf0debc39661">begin</a> (const uint32_t branch_type, const uint16_t user_version, const <a class="el" href="structdc_info__t.html">dcInfo_t</a> *dc_info, const uint8_t dc_num, const uint16_t min_lib_buildno=0)</td></tr>
<tr class="separator:a1964aeda33f77fd8a3fdcf0debc39661"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71ec150e42956850860595993ccc2006"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_available_num__t.html">AvailableNum_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a71ec150e42956850860595993ccc2006">available</a> (void)</td></tr>
<tr class="separator:a71ec150e42956850860595993ccc2006"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac91f9f4b9017a439028bc4edcf78a4e1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_scaler_data__t.html">ScalerData_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#ac91f9f4b9017a439028bc4edcf78a4e1">read</a> (void)</td></tr>
<tr class="separator:ac91f9f4b9017a439028bc4edcf78a4e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ad67086e8afa7157212e68f4df290e2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_raw_data__t.html">RawData_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a4ad67086e8afa7157212e68f4df290e2">readRaw</a> (void)</td></tr>
<tr class="separator:a4ad67086e8afa7157212e68f4df290e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac88b9f45b8aa3cd72e009aa3a2682fdb"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#ac88b9f45b8aa3cd72e009aa3a2682fdb">write</a> (const uint8_t dc_n, const int32_t data_scaler)</td></tr>
<tr class="separator:ac88b9f45b8aa3cd72e009aa3a2682fdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25a82bec5ab0b54a77ddc1375b292946"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a25a82bec5ab0b54a77ddc1375b292946">writeRaw</a> (const uint8_t *data, const size_t data_len, const dataType_t data_type=DATA_TYPE_DCDT)</td></tr>
<tr class="separator:a25a82bec5ab0b54a77ddc1375b292946"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33e6fec58aa09269ba5c7a3893c9cb88"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a33e6fec58aa09269ba5c7a3893c9cb88">flush</a> (void)</td></tr>
<tr class="separator:a33e6fec58aa09269ba5c7a3893c9cb88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a4acc28659e8954c9ead2c275b9ca7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vivicore_serial.html#a9a4acc28659e8954c9ead2c275b9ca7a">end</a> (void)</td></tr>
<tr class="separator:a9a4acc28659e8954c9ead2c275b9ca7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class is for branch to talk with core. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a71ec150e42956850860595993ccc2006"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71ec150e42956850860595993ccc2006">&#9670;&nbsp;</a></span>available()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_available_num__t.html">AvailableNum_t</a> VivicoreSerial::available </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Before using <a class="el" href="class_vivicore_serial.html#ac91f9f4b9017a439028bc4edcf78a4e1">read</a> or <a class="el" href="class_vivicore_serial.html#a4ad67086e8afa7157212e68f4df290e2">readRaw</a>, the number of available data should be checked with this API. This API returns <a class="el" href="struct_available_num__t.html">AvailableNum_t</a> as the following.</p>
<ul>
<li>If <a class="el" href="struct_available_num__t.html#af1a9f9c9eed381453a2c10125dd19987">AvailableNum_t::scaler</a> is greater than 0:<ul>
<li>This API has stored data received from core and decoded by <a class="el" href="class_data_code_translator.html#a932f5148033811a9ac1b91fb8b12b45c">DataCodeTranslator::decode</a></li>
<li><a class="el" href="struct_available_num__t.html#af1a9f9c9eed381453a2c10125dd19987">AvailableNum_t::scaler</a> is the number of DC decoded (e.g. The number is 2 if data for DC 1 and 2 is received)</li>
<li>The decoded data may have some errors which are handled in <a class="el" href="class_vivicore_serial.html#ac91f9f4b9017a439028bc4edcf78a4e1">read</a></li>
</ul>
</li>
<li>If <a class="el" href="struct_available_num__t.html#ab10eef7f53baac88e079ea9ba0e9798a">AvailableNum_t::raw</a> is 1:<ul>
<li>This API has stored a raw data packet received from core</li>
</ul>
</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>Number of scaler and raw data received from core. 0 is no data available. </dd></dl>

</div>
</div>
<a id="a1964aeda33f77fd8a3fdcf0debc39661"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1964aeda33f77fd8a3fdcf0debc39661">&#9670;&nbsp;</a></span>begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool VivicoreSerial::begin </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>branch_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>user_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdc_info__t.html">dcInfo_t</a> *&#160;</td>
          <td class="paramname"><em>dc_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>dc_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&#160;</td>
          <td class="paramname"><em>min_lib_buildno</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API initializes this library instance and store configuration to communicate with core. The instance can be configured by arguments of this API. This API returns true or false which is returned by <a class="el" href="class_data_code_translator.html#a0a8c4f193b5107bba60ee2a024ccd6b1">DataCodeTranslator::init</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">branch_type</td><td>Branch type value </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user_version</td><td>Version number for user program </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_info</td><td>Pointer to buffer of DC info array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_num</td><td>Number of DC info array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_lib_buildno</td><td>(Optional) Minimum required library build number which is defined as LIBRARY_VER_BUILD_NO </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if no error, or another in error case. </dd></dl>

</div>
</div>
<a id="a9a4acc28659e8954c9ead2c275b9ca7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a4acc28659e8954c9ead2c275b9ca7a">&#9670;&nbsp;</a></span>end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VivicoreSerial::end </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API terminates talking with core as the following sequence.</p><ol type="1">
<li>Wait for transmission of outgoing data</li>
<li>Disable UART to talk with core</li>
<li>Drop all received data </li>
</ol>

</div>
</div>
<a id="a33e6fec58aa09269ba5c7a3893c9cb88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a33e6fec58aa09269ba5c7a3893c9cb88">&#9670;&nbsp;</a></span>flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool VivicoreSerial::flush </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API encodes the data stored by <a class="el" href="class_vivicore_serial.html#ac88b9f45b8aa3cd72e009aa3a2682fdb">write</a>. This API sends the encoded data which is succeeded to be encoded or raw data stored by <a class="el" href="class_vivicore_serial.html#a25a82bec5ab0b54a77ddc1375b292946">writeRaw</a>, and waits to finish sending. This API does nothing and returns if no data to send.</p>
<dl class="section return"><dt>Returns</dt><dd>true if no error, or another in error case of <a class="el" href="class_data_code_translator.html#ac7b20d18ba9f5961041772a84c7d6803">DataCodeTranslator::encode</a>. </dd></dl>

</div>
</div>
<a id="ac91f9f4b9017a439028bc4edcf78a4e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac91f9f4b9017a439028bc4edcf78a4e1">&#9670;&nbsp;</a></span>read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_scaler_data__t.html">ScalerData_t</a> VivicoreSerial::read </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API returns data including decoded DC number, scaler value, and success information. Before calling this API, it is necessary to check if there is available data with <a class="el" href="class_vivicore_serial.html#a71ec150e42956850860595993ccc2006">available</a>. This API returns false in <a class="el" href="struct_scaler_data__t.html#ac9027467aa85997676091a2202ce3449">ScalerData_t::success</a> and does nothing in any case of the following conditions.</p>
<ul>
<li>In case that <a class="el" href="class_vivicore_serial.html#a71ec150e42956850860595993ccc2006">available</a> returns 0 on <a class="el" href="struct_available_num__t.html#af1a9f9c9eed381453a2c10125dd19987">AvailableNum_t::scaler</a></li>
</ul>
<p>This API returns false in <a class="el" href="struct_scaler_data__t.html#ac9027467aa85997676091a2202ce3449">ScalerData_t::success</a> but also returns the stored data in any case of the following conditions.</p>
<ul>
<li>data_scaler is out of range between DC min and DC max specified on DC info by <a class="el" href="class_vivicore_serial.html#a1964aeda33f77fd8a3fdcf0debc39661">begin</a></li>
<li>dc_n is for DC_NATURE_OUT specified on DC info by <a class="el" href="class_vivicore_serial.html#a1964aeda33f77fd8a3fdcf0debc39661">begin</a></li>
<li>dc_n is for DC_TYPE_BINARY specified on DC info by <a class="el" href="class_vivicore_serial.html#a1964aeda33f77fd8a3fdcf0debc39661">begin</a></li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>Read data from core. <a class="el" href="struct_scaler_data__t.html#ac9027467aa85997676091a2202ce3449">ScalerData_t::success</a> is true if no error. false in another case. </dd></dl>

</div>
</div>
<a id="a4ad67086e8afa7157212e68f4df290e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ad67086e8afa7157212e68f4df290e2">&#9670;&nbsp;</a></span>readRaw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_raw_data__t.html">RawData_t</a> VivicoreSerial::readRaw </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API stores raw data received from core. The raw data is equivalent to the received packet body. Before calling this API, it is necessary to check if there is available data with <a class="el" href="class_vivicore_serial.html#a71ec150e42956850860595993ccc2006">available</a>. This API returns false in <a class="el" href="struct_raw_data__t.html#a5b4976aab8d8673a72682a282e64a3a9">RawData_t::success</a> and does nothing in any case of the following conditions.</p>
<ul>
<li>In case that <a class="el" href="class_vivicore_serial.html#a71ec150e42956850860595993ccc2006">available</a> returns 0 on <a class="el" href="struct_available_num__t.html#ab10eef7f53baac88e079ea9ba0e9798a">AvailableNum_t::raw</a></li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>Read data from core. <a class="el" href="struct_raw_data__t.html#a5b4976aab8d8673a72682a282e64a3a9">RawData_t::success</a> is true if no error. false in another case. </dd></dl>

</div>
</div>
<a id="ac88b9f45b8aa3cd72e009aa3a2682fdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac88b9f45b8aa3cd72e009aa3a2682fdb">&#9670;&nbsp;</a></span>write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool VivicoreSerial::write </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>dc_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int32_t&#160;</td>
          <td class="paramname"><em>data_scaler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API stores scaler data to be sent to core corresponding to DC number. It is necessary to call <a class="el" href="class_vivicore_serial.html#a33e6fec58aa09269ba5c7a3893c9cb88">flush</a> to send the stored data to core. The stored value specified by DC number can be overwritten if this API was called multiple times. This API returns error and does not store the specified data in any case of the following conditions.</p>
<ul>
<li>dc_n is out of range between 1 to the maximum value <a class="el" href="_communication_protocol_8h.html#aec0a43acd425b4244ea08795f0e262ab">NUM_MAX_DC</a> in specification</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_n</td><td>DC number corresponding to data_scaler </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_scaler</td><td>Scaler data to be sent to core </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if no error, or another in error case.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This API should not be used with <a class="el" href="class_vivicore_serial.html#a25a82bec5ab0b54a77ddc1375b292946">writeRaw</a> in user probram on a *.ino file. If you do that, the program may behave unintentionally. </dd></dl>

</div>
</div>
<a id="a25a82bec5ab0b54a77ddc1375b292946"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25a82bec5ab0b54a77ddc1375b292946">&#9670;&nbsp;</a></span>writeRaw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool VivicoreSerial::writeRaw </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>data_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const dataType_t&#160;</td>
          <td class="paramname"><em>data_type</em> = <code>DATA_TYPE_DCDT</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This API stores raw data to be sent to core. The raw data is equivalent to the sending packet body. It is necessary to call <a class="el" href="class_vivicore_serial.html#a33e6fec58aa09269ba5c7a3893c9cb88">flush</a> to send the stored data to core. The stored data can be overwritten if this API was called multiple times. This API returns error but stores data truncated with the internal buffer size in any case of the following conditions.</p>
<ul>
<li>data_len is over <a class="el" href="_communication_protocol_8h.html#ac481195db6401d611bc936128ce0276a">NUM_MAX_UART_PKT_BODY_DATA</a></li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Pointer to buffer of raw data to be sent to core </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_len</td><td>Size of buffer of raw data to be sent to core </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_type</td><td>Type of raw data to be sent to core </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if no error, or another in error case.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This API now supports DATA_TYPE_DCDT only. </dd>
<dd>
This API should not be used with <a class="el" href="class_vivicore_serial.html#ac88b9f45b8aa3cd72e009aa3a2682fdb">write</a> in user probram on a *.ino file. If you do that, the program may behave unintentionally. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_vivicore_serial_8h_source.html">VivicoreSerial.h</a></li>
<li>VivicoreSerial.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
